const f=require("fs").promises,h=require("path"),S=require("deepmerge"),v=require("gulp-environment"),{importDirectory:q,cleanupSVG:y,parseColors:C,isEmptyColor:w,runSVGO:b}=require("@iconify/tools"),{getIcons:j,stringToIcon:E,getIconsCSS:x}=require("@iconify/utils");v.current.name;const d=(()=>{const t=require("../../build-config");return t.base.serverPath,t.base.buildTemplatePath,t.base.buildPath,S.all([{},t.base||{},t.production||{}])})(),i={json:[require.resolve("@iconify/json/json/bx.json"),require.resolve("@iconify/json/json/bxl.json"),require.resolve("@iconify/json/json/bxs.json")]},p=h.resolve(__dirname,"../../"+d.distPath.replace(/^\.\//,"")+"/fonts/iconify-icons.css");(async function(){var t;try{const s=[];if(i.json)for(let r=0;r<i.json.length;r++){const e=i.json[r],o=typeof e=="string"?e:e.filename,n=JSON.parse(await f.readFile(o,"utf8"));if(typeof e!="string"&&((t=e.icons)!=null&&t.length)){const a=j(n,e.icons);if(!a)throw new Error(`Cannot find required icons in ${o}`);s.push(a)}else s.push(n)}if(i.svg)for(let r=0;r<i.svg.length;r++){const e=i.svg[r],o=await q(e.dir,{prefix:e.prefix});await o.forEach(async(n,a)=>{if(a!=="icon")return;const c=o.toSVG(n);if(!c){o.remove(n);return}try{await y(c),e.monotone&&await C(c,{defaultColor:"currentColor",callback:(l,m,u)=>!u||w(u)?m:"currentColor"}),await b(c)}catch(l){console.error(`Error parsing ${n} from ${e.dir}:`,l),o.remove(n);return}o.fromSVG(n,c),s.push(o.export())})}const g=s.map(r=>x(r,Object.keys(r.icons),{iconSelector:".{prefix}-{name}",commonSelector:".bx",format:d.minify?"compressed":"expanded"})).join(`
`);await f.writeFile(p,g,"utf8"),console.log(`Saved CSS to ${p}`)}catch(s){console.error("Error during icon CSS generation:",s)}})();
